CREATE TABLE PART (P_PARTKEY INTEGER, P_NAME STRING, P_MFGR STRING, P_BRAND STRING, P_TYPE STRING, P_SIZE INTEGER, P_CONTAINER STRING, P_RETAILPRICE DOUBLE, P_COMMENT STRING);
CREATE TABLE SUPPLIER (S_SUPPKEY INTEGER, S_NAME STRING, S_ADDRESS STRING, S_NATIONKEY INTEGER, S_PHONE STRING, S_ACCTBAL DOUBLE, S_COMMENT STRING);
CREATE TABLE PARTSUPP (PS_PARTKEY INTEGER, PS_SUPPKEY INTEGER, PS_AVAILQTY INTEGER, PS_SUPPLYCOST DOUBLE, PS_COMMENT STRING);
CREATE TABLE CUSTOMER (C_CUSTKEY INTEGER, C_NAME STRING, C_ADDRESS STRING, C_NATIONKEY INTEGER, C_PHONE STRING, C_ACCTBAL DOUBLE, C_MKTSEGMENT STRING, C_COMMENT STRING);
CREATE TABLE ORDERS (O_ORDERKEY INTEGER, O_CUSTKEY INTEGER, O_ORDERSTATUS STRING, O_TOTALPRICE DOUBLE, O_ORDERDATE DATE, O_ORDERPRIORITY STRING, O_CLERK STRING, O_SHIPPRIORITY INTEGER, O_COMMENT STRING);
CREATE TABLE LINEITEM (L_ORDERKEY INTEGER, L_PARTKEY INTEGER, L_SUPPKEY INTEGER, L_LINENUMBER INTEGER, L_QUANTITY DOUBLE, L_EXTENDEDPRICE DOUBLE, L_DISCOUNT DOUBLE, L_TAX DOUBLE, L_RETURNFLAG STRING, L_LINESTATUS STRING, L_SHIPDATE DATE, L_COMMITDATE DATE, L_RECEIPTDATE DATE, L_SHIPINSTRUCT STRING, L_SHIPMODE STRING, L_COMMENT STRING);
CREATE TABLE NATION(N_NATIONKEY INTEGER, N_NAME STRING, N_REGIONKEY INTEGER, N_COMMENT STRING);
CREATE TABLE REGION(R_REGIONKEY INTEGER, R_NAME STRING, R_COMMENT STRING);
CREATE TABLE PLAYERS(ID STRING, FIRSTNAME STRING, LASTNAME STRING, FIRSTSEASON INTEGER, LASTSEASON INTEGER, WEIGHT INTEGER, BIRTHDATE DATE);

SELECT * FROM NATION A, (SELECT N_NAME, N_NATIONKEY, N_REGIONKEY FROM NATION) B WHERE A.N_NATIONKEY = B.N_NATIONKEY;
SELECT * FROM NATION A, (SELECT * FROM NATION) B WHERE A.N_NATIONKEY = B.N_NATIONKEY;
SELECT * FROM NATION A, NATION B WHERE A.N_NATIONKEY = B.N_NATIONKEY;
SELECT * FROM NATION A, NATION B WHERE B.N_NATIONKEY = A.N_NATIONKEY;

SELECT CUSTOMER.C_CUSTKEY, SUM(LINEITEM.L_EXTENDEDPRICE * (1 + LINEITEM.L_DISCOUNT)) AS REVENUE, CUSTOMER.C_ACCTBAL 
FROM CUSTOMER, ORDERS, LINEITEM, NATION 
WHERE CUSTOMER.C_CUSTKEY = ORDERS.O_CUSTKEY 
AND (LINEITEM.L_DISCOUNT < .06 OR LINEITEM.L_QUANTITY < 24) 
AND LINEITEM.L_ORDERKEY = ORDERS.O_ORDERKEY 
AND LINEITEM.L_RETURNFLAG = 'R' 
AND CUSTOMER.C_NATIONKEY = NATION.N_NATIONKEY 
GROUP BY CUSTOMER.C_CUSTKEY, CUSTOMER.C_ACCTBAL 
ORDER BY REVENUE ASC LIMIT 20;

SELECT SUM(L_EXTENDEDPRICE*L_DISCOUNT) AS REVENUE 
FROM LINEITEM 
WHERE L_DISCOUNT > 0.04 
AND L_DISCOUNT < 0.08;

SELECT LINEITEM.L_ORDERKEY, SUM(LINEITEM.L_EXTENDEDPRICE*(1-LINEITEM.L_DISCOUNT)) AS REVENUE, ORDERS.O_ORDERDATE, ORDERS.O_SHIPPRIORITY 
FROM CUSTOMER, ORDERS, LINEITEM 
WHERE CUSTOMER.C_MKTSEGMENT = 'BUILDING' 
AND CUSTOMER.C_CUSTKEY = ORDERS.O_CUSTKEY 
AND LINEITEM.L_ORDERKEY = ORDERS.O_ORDERKEY 
AND (LINEITEM.L_DISCOUNT < .06 OR LINEITEM.L_QUANTITY < 24) 
GROUP BY ORDERS.O_ORDERDATE, ORDERS.O_SHIPPRIORITY, LINEITEM.L_ORDERKEY 
ORDER BY REVENUE DESC, ORDERS.O_ORDERDATE;

SELECT L_LINESTATUS, O_ORDERKEY, SUM(L_QUANTITY) AS SUM_QTY, SUM(L_EXTENDEDPRICE) AS SUM_BASE_PRICE, SUM(L_EXTENDEDPRICE*(1-L_DISCOUNT)) AS SUM_DISC_PRICE, SUM(L_EXTENDEDPRICE*(1-L_DISCOUNT)*(1+L_TAX)) AS SUM_CHARGE, AVG(L_QUANTITY) AS AVG_QTY, AVG(L_EXTENDEDPRICE) AS AVG_PRICE, AVG(L_DISCOUNT) AS AVG_DISC 
FROM LINEITEM,ORDERS 
GROUP BY L_LINESTATUS, O_ORDERKEY 
ORDER BY L_LINESTATUS;

SELECT SUM(SUB_Q.P1_WEIGHT*1.0) 
FROM (SELECT P1.FIRSTNAME AS P1_FIRSTNAME, 
			P1.LASTNAME AS P1_LASTNAME, 
			P2.FIRSTNAME AS P2_FIRSTNAME, 
			P2.LASTNAME AS P2_LASTNAME, 
			P1.FIRSTSEASON AS P1_FIRSTSEASON, 
			P1.LASTSEASON AS P1_LASTSEASON, 
			P2.FIRSTSEASON AS P2_FIRSTSEASON, 
			P2.LASTSEASON AS P2_LASTSEASON, 
			P1.WEIGHT AS P1_WEIGHT 
		FROM PLAYERS P1, PLAYERS P2 WHERE P1.ID = P2.ID AND P1.FIRSTSEASON < 2007) SUB_Q;
		

SELECT CUSTOMER.C_CUSTKEY, CUSTOMER.C_ACCTBAL 
FROM CUSTOMER, ORDERS, LINEITEM
WHERE CUSTOMER.C_CUSTKEY = ORDERS.O_CUSTKEY 
AND (LINEITEM.L_DISCOUNT < .06 OR LINEITEM.L_QUANTITY < 24) 
AND LINEITEM.L_ORDERKEY = ORDERS.O_ORDERKEY 
AND LINEITEM.L_RETURNFLAG = 'R';
		